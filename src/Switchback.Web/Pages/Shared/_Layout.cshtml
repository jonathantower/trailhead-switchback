@{
    var path = Context.Request.Path.Value ?? "";
    var isAuth = User.Identity?.IsAuthenticated == true;
    var isHome = path == "/" || path.Equals("/Index", StringComparison.OrdinalIgnoreCase);
    var isConnections = path.IndexOf("/Connections", StringComparison.OrdinalIgnoreCase) >= 0;
    var isRules = path.IndexOf("/Rules", StringComparison.OrdinalIgnoreCase) >= 0;
    var isActivity = path.IndexOf("/Activity", StringComparison.OrdinalIgnoreCase) >= 0;
    var isLogin = path.IndexOf("/Login", StringComparison.OrdinalIgnoreCase) >= 0;
    var isRegister = path.IndexOf("/Register", StringComparison.OrdinalIgnoreCase) >= 0;
    var showSidebar = !isLogin && !isRegister;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Switchback</title>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
    @if (showSidebar)
    {
        <div class="app-wrapper">
            <aside class="sidebar">
                <div class="sidebar-brand">
                    <a asp-page="/Index">Switchback</a>
                </div>
                <nav class="sidebar-nav-section">
                    <div class="sidebar-nav-label">Platform</div>
                    <nav class="sidebar-nav">
                        <a asp-page="/Index" class="@(isHome ? "active" : "")">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            Home
                        </a>
                        @if (isAuth)
                        {
                            <a asp-page="/Connections" class="@(isConnections ? "active" : "")">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                                Connections
                            </a>
                            <a asp-page="/Rules/Index" class="@(isRules ? "active" : "")">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                                Rules
                            </a>
                            <a asp-page="/Activity" class="@(isActivity ? "active" : "")">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                Activity
                            </a>
                        }
                        else
                        {
                            <a asp-page="/Login" class="@(isLogin ? "active" : "")">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                                Log in
                            </a>
                            <a asp-page="/Register" class="@(isRegister ? "active" : "")">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
                                Sign up
                            </a>
                        }
                    </nav>
                </nav>
                @if (isAuth)
                {
                    <div class="sidebar-footer">
                        <div class="sidebar-user">
                            <span class="name">@(User.Identity?.Name ?? "User")</span>
                        </div>
                        <a asp-page="/Logout" style="display:inline-block; margin-top:0.5rem;">Log out</a>
                    </div>
                }
            </aside>
            <main class="main-content">
                @RenderBody()
            </main>
        </div>
    }
    else
    {
        <div class="app-wrapper auth-layout">
            <main class="main-content">
                @RenderBody()
            </main>
        </div>
    }
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
